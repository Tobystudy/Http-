# 리다이렉션과 부하균형
이 장에서는 디라이렉션 기술에 대한 장으로 리다이렉션은 보통 메시지가 프락시, 캐시, 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위해 사용한다.

이 장에서는 여러 리다이렉션 기법과 그것들이 어떻게 동작하고 어떤 부하 균형 능력을 갖는지 알아본다.
## 왜 리다이렉트인가
리다이렉션은 피할 수 없는것

HTTP애플리케이션은 다음 세 가지를 원하기 떄문이다.
- 신뢰할 수 있는 HTTP트랜잭션의 수행
- 지연 최소화
- 네트워크 대역폭 절약

이러한 이유때문에 웹 콘텐츠는 여러 장소에 배포된다.

즉 여러 장소에 배포(리다이렉트를 이용)시 이점은 다음과 같다는 말
- 한 곳에서 실패시 다른곳을 이용할 수 있다 : 신뢰성 개선
- 클라이언트가 보다 가까운 리소스에 접근하게 된다 : 응답시간이 줄어든다
- 목적지가 분산되므로 네트워크 혼잡도가 줄어든다
## 리다이렉트 할 곳
서버, 프락시, 캐시, 게이트웨이는 클라이언트가 그들에게 HTTP 요청을 보내고, 요청을 처리한다는 관점에서 클라이언트에게는 모두가 서버라고 할 수 있다.

서버, 프락시, 캐시, 게이트웨이가 모두 공통적으로 서버의 특성을 갖기에 많은 리다이렉션 기법이 모두 동일하게 동작한다.

> 어떠한 리다이렉션 기법은 특별 종단만을 위해 설계되어 일반적으로 적용하기엔 불가능하다.

웹서버는 IP별로 요청을 처리한다. 복제된 서버들로 요청을 분산한다는 것은 같은 URL에 대해 여러곳에서 온 요청들을 각각 최적의 웹 서버로 보내는것.

프락시는 프로토콜별로 요청을 다르며 이웃의 모든 HTTP트래픽은 프락시를 거치는게 이상적이다.<br>프락시 캐시가 있기 때문.

프락시로의 리다이렉트는 주 진입로의 트래픽(그게 어느 요청[목적지]이던 간에)을 근처의 지름길로 빨아들이는것이다.
## 리다이렉션 프로토콜의 개요
리다이렉션의 목표 : HTTP메시지를 가용한 웹 서버로 가급적 빠르게 보내는것.
## 일반적인 리다이렉션 방법
트래픽을 서버로 리다이렉트 하는 기법
### HTTP 리다이렉션
HTTP 상태코드를 이용한 리다이렉션.<br>요청을 처리하는 서버가 가용가능한 것 중 부하가 가장 적은 것을 골라 해당 요청을 그 곳으로 리다이렉트 한다.

HTTP 리다이렉션의 장점중 하나는 리다이렉트 하는 서버가 클라이언트의 아이피 주소를 안다는 것. 이를 이용해 좀 더 정보에 근거해 선택할 수 있다.

HTTP 리다이렉션의 단점의 예는 다음과 같다.
- 어떤 서버로 리다이렉트할지 결정하기 위해서 원 서버는 상당히 많은 처리를 해야한다.<br> 부하를 줄이기위한 리다이렉트인데 줄이려한 부하만큼의 처리가 필요할 수 있다.
- 페이지에 접근할 때마다 두 번의 왕복이 필요하기 떄문에 사용자는 더 오래 기다려야한다.
- 리다이렉트 서버가 고장나면 사이트도 고장난다.

약점을 보안하기 위해 다른 리다이렉션 기법과 조합하여 사용한다.
### DNS 리다이렉션
클라이언트가 웹 사이트에 접근하려 할 때 마다 도메인 이름 www.~~~.com은 아이피 주소로 분석되야한다.<br>
DNS는 하나의 도메인에 여러 아이피 주소가 결부되는것을 허용한다. DNS분석자는 하나의 도메인에 여러 아이피 주소를 반환 하도록 설정되거나 프로그래밍 될 수 있다.<br>이러한 상환에서 분석자는 어떤 아이피주소를 반환할 것인가에 대한 결정 방법으로 간단하게는 RR부터 서버의 부하를 검사하여 가장 적은 부하를 가지는 서버의 아이피를 돌려주는 복잡한 방법까지 다양하게 결정할 수 있다.
#### DNS 캐싱의 효과
DNS 주소 순환은 매 번 서버주소를 다른 순서로 가져오지만 이는 부하의 균형을 완벽하게 조절할 수 없다.<br>
자식 DNS서버에 의해 기억되어 재사용 될 수 있기 때문이다.

이더넷에서 MAC주소와 IP주소를 이용해 응답의 경로를 제어할 수 있다.
## 프락시 리다이렉션 방법
트래픽을 프락시와 게이트웨이로 리다이렉트하는 기법<br>
콘텐츠를에 접근할 때 프락시를 통과해야할 필요가 있을 수도 혹은 프락시 캐시가 네트워크 안에 있을 수도 있다.<br>
클라이언트는 어떻게 프락시로 가는 길은 알 수 있을까
- 명시적인 브라우저 설정<br> : 브라우저의 풀다운 메뉴등을 통한 명시적인 설정, 프락시가 응답하지 않더라도 원서버와 접촉하지 않고 프락시가 다운되거나 브라우저가 잘못 설정되더라도 접속에 문제를 겪을것이다.<br>네트워크 아키텍처가 변경되었을 때에도 모든 엔드유저에게 접파하는것이 어렵다.
- 동적인 자동설정<br> : 프락시 자동설정(Proxy Auto-configuration, PAC)프로토콜을 이용해 브라우저가 URL별로 접촉해야할 프락시를 브라우저가 재시작 할 때 마다 PAC파일에서 찾도록 하는 방법.
- 자연스러운 가로채기<br> : WPAD(Web Proxy Autodiscovery Protocol) 인터넷 서버로부터 PAC파일의 위치를 알아내고 해당 파일을 이용헤서 프락시 서버의 이름을 알 수 있도록 하는 방법.
## 캐시 리다이렉션 방법
