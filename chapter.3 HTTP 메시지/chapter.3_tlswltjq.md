# 03. HTTP 메시지
이번장에서는
- 메세지가 어떻게 흘러가는가?
- HTTP 메세지의 세 부분
- 요청과 응답메시지의 차이
- 요청 메시지가 지원하는 메서드들
- 응답 메시지가 반환하는 상태 코드들
- HTTP 헤더들은 무슨일을 하는가?
## 3.1 메시지의 흐름
HTTP 메시지는 HTTP어플리케이션 간에 주고받은 데이터의 블록들<br>
인바운드, 아웃바운드, 업스트립, 다운스트림은 메시지의 흐름을 표현하는 용어
### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다
[이미지 첨부]<br>
인바운드 아웃바운드는 이해가 감 왜냐면 HTTP메시지 통신은 리퀘스트를 보내고 받는거니까 클라이언트측 -> 서버측 -> 클라이언트측 방향으로 흐르는것
### 3.1.2 다운 스트림으로 흐르는 메시지
? : 그러나 업스트림과 다운스트림은 용어에 담긴 의미가 있는지 모르겠음 모든 메시지는 요청과 응답에 관계없이 다운스트림으로 흐른다는것. 업과 다운 위 아래의 차이는 무엇인지 모르겠음.
## 3.2 메시지의 각 부분
[이미지 첨부]<br>
HTTP는 간단하고 구조화된 데이터 블럭.<br>
HTTP 메시지는 다음 세 부분으로 이루어진다.<br>

|||
|--|--|
|시작줄|어떠한 메세지인지 서술|
|헤더 블록|속성을 담고있음|
|본문|데이터를 담고있음(없을 수도 있다.)|
- 시작줄과 헤더 : 줄단위로 분리된 문자열.<br>
각 줄은 캐리지 리턴(ASCII 13)과 개행문자(ASCII 10)로 구성된 줄바꿈 문자열로 끝난다<br>
일부 어플리케이션을 위해 그냥 개행문자도 받아들일 수 있어야 견고한 어플리케이션.
- 본문 : 데이터 덩어리

|값|의미|
|-|-|
|10|LF ( Line Feed => 다음 줄로)|
|13|CR ( Cariage Return => 제일 처음 칸으로)|
### 3.2.1 메시지 문법
[이미지 첨부]<br>
메시지의 형식
#### 요청
<메서드> <요청 URL> <버전>
<헤더>

<엔터티 본문>

#### 응답
<버전> <상태 코드> <사유 구절>
<헤더>

<엔터티 본문><br><br>
- 메서드 : 클라이언트 측에서 서버가 리소스에 수행하길 바라는 동작
- 요청 URL : 리소스의 경로
- 버전 : 메시지에서 사용중인 HTTP의 버전<br>
HTTP/<메이저>.<마이너>
- 상태코드 : 요청중 일어난 일을 설명하는 세 자리 숫자<br> 첫 자리는 일반적인 분류를 나타낸다.
- 사유구절 : 사람이 읽고 결과를 이해할 수 있도록 설명하는 짧은 문구<br>200 not ok와 200 ok는 사유구절이 다르지만 동등하게 성공을 의미하는것으로 처리되어야함.
- 헤더들 : 이름, 콜론(:), 공백, 값, CRLF가 순서대로 나타는 n개의 헤더들
- 엔터티 본문 : 임의의 데이터블록을 포함, 없을 수도 있음
### 3.2.2 시작줄
요청(시작)줄 : 메서드 + 요청 URL + HTTP버전 <br>
응답(시작) : HTTP버전 + 상태코드 + 사유구절<br>

| 메서드   | 설명| 메시지 본문의 유무 |
|--|--|--|
| GET     | 서버로부터 어떤 문서를 가져온다.       | 아니오|
| HEAD    | 서버에서 어떤 문서에 대해 해더만 가져온다.     | 아니오|
| POST    | 서버가 처리해야 할 데이터를 보낸다.           | 예|
| PUT     | 서버에 요청 메시지의 본문을 저장한다.| 예|
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다.| 아니오|
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.| 아니오|
| DELETE  | 서버에서 문서를 제거한다.|아니오|

모든 서버가 모든 메서드를 구현하지 않는다.<br>
HTTP는 쉽게 확장될 . 수있도록 설계되었기에 그들만의 추가메서드 "확장 메서드"가 구현되어 있을 수 있다.

| 범위 | 정의된 범위 | 분류 |
|--|--|---|
| 100-199  | 100-101 | 정보 |
| 200-299  | 200-206 | 성공 |
| 300-399  | 300-305 | 리디렉션 |
| 400-499  | 400-415 | 클라이언트 에러 |
| 500-599  | 500-505 | 서버에러 |

자주 사용되는 상태코드
| 상태 코드 | 사유 구절 | 의미 |
|--|--|--|
| 200 | OK | 요청이 성공적으로 처리되었음을 나타냄 |
| 201 | Created | 새로운 리소스가 성공적으로 생성되었음을 나타냄 |
| 204 | No Content | 요청이 성공적으로 처리되었지만 컨텐츠는 없음을 나타냄 |
| 301 | Moved Permanently | 요청한 리소스가 새로운 위치로 영구적으로 이동되었음을 나타냄|
| 400 | Bad Request | 요청이 잘못되었음을 나타냄|
| 401 | Unauthorized | 인증되지 않은 요청을 나타냄 |
| 403 | Forbidden | 요청이 거부되었음을 나타냄 |
| 404 | Not Found | 요청한 리소스를 찾을 수 없음을 나타냄 |
| 500 | Internal Server Error | 서버에서 요청을 처리하는 중에 에러가 발생했음을 나타냄 |
| 503 | Service Unavailable | 서버가 일시적으로 요청을 처리할 수 없음을 나타냄 |

버전 번호는 어떠한 어플리케이션이 지원하는 가장 높은 HTTP버전 해당 메시지의 HTTP버전이 아니다!
### 3.2.3 헤더
헤더의 분류
- 일반헤더 : 요청과 응답 양쪽에 모두 나타날 수 있음.
- 요청헤더 : 요청에 대한 부가 정보를 제공
- 응답 헤더 : 응답에 대한 부가 정보를 제공.
- Entity 헤더 : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술.
- 확장 헤더 : 명세에 정의되지않은 세로운 헤더.
### 3.2.4 엔티티 본문
### 3.2.5 버전 0.9 메시지
[이미지 첨부]<br>
0.9는 초기 HTTP의 버전. 응답은 오직 엔터티뿐이였고 요청URL뿐이였다.

## 3.3 메서드
### 3.3.1 안전한 메서드(Safe Method)
GET과 HEAD는 안전하다고 할 수 있다.<br>
안전하다는 것의 의미 = 요청의 결과로 서버에 일어나는 일은 아무것도 없다는것. 리소스에 대한 상태변화가 없다.
### 3.3.2 GET
### 3.3.3 HEAD
GET처럼 행동 하지만 서버는 응답으로 헤더만 돌려준다.<br>
클라이언트는 리소스를 가져올 필요 없이 헤더만을 조사할 수 있도록 해준다.
- 리소스를 가져오지않고 그것이 무엇인지 알아낼 수 있다.
- 응답의 상태코드를 이용해 개체가 존재하는지 확인할 수 있다.
- 헤더를 통해 리소스가 변경되었는지 검사할 수 있다.

서버 개발자는 GET과 HEAD의 헤더가 일치함을 보장해야한다.
### 3.3.4 PUT
서버에 요청의 본문을 통해 문서를 새로 만들거나 교체<br>
멱등을 지킨다
### 3.3.5 POST
데이터를 서버에 보내기위해 사용 PUT은 서버에 있는 리소스에 데이터를 "입력"하기위해 사용.<br>
멱등을 안지킬 수 있다.<br>
신용조회, 지급(결제) 와같은 경우에서 실제로는 조회(GET POST PUT 복합적인 행위를 함)인데 멱등이 요구된다.
### 3.3.6 TRACE
프락시를 통과해가며 응답 메시지에 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답을 돌려준다. 이를 반복해 클라이언트가 요청/응답의 메시지를 검사할 수 있다.
### 3.3.7 OPTIONS
서버에게 여러 종류의 지원범위에 대해 물어볼 수 있다. 특정 리소스에 대한 메서드 지원여부.
이 방식을 이용해 접근하지 않고 접근방법을 알 수 있다. 
### 3.3.8 DELETE
예상하는 행동을 하지만 HTTP의 명세에 따라 서버가 클라이언트에 알리지않고 요청을 무시할 수 있기 때문에 삭제 수행을 보장하진 않는다.
### 3.3.9 확장 메서드

| 메서드| 설명 |
|--|--|
| PROPFIND  | 리소스에 대한 속성 검색을 요청합니다.|
| PROPPATCH | 리소스의 속성을 수정합니다.|
| MKCOL     | 새 컬렉션(디렉터리)을 만듭니다.|
| LOCK      | 리소스에 대한 잠금을 설정합니다.|
| UNLOCK    | 리소스의 잠금을 해제합니다.|
## 3.4 상태 코드
### 3.4.1 100-199: 정보성 상태코드
#### 100 Continue
클라이언트가 엔터티를 서버에 보내려고하고 그 전에 100 Continue응답을 기다리려고 한다면 값이 100 Continue인 Expect 요청 헤더를 보낼 필요가 있다.<br>
엔터티를 보내지 않으려한다면 혼란을 야기하기에 해당 헤더를 보내선 안된다.<br>
클라이언트가 100 Continue 가 담긴 Expect헤더를 요청한다면 서버는 100 Continue 혹은 에러코드로 응답해야 한다.


### 3.4.2 200-299: 성공 상태 코드
| 상태 코드 | 사유 구절 | 의미 |
|--|--|--|
| 200 | OK | 요청이 성공적으로 처리되었고 본문에 요청한 리소스를 포함하고 있음. |
| 201 | Created | 새로운 리소스가 성공적으로 생성되었음을 나타냄. |
| 202 | Accepted | 요청이 수락되었으나 어떤 동작도 수행하지 않았다. |
| 203 | Non-Authoritative Information |	요청에 대한 응답이 원 서버의 정보가 아닌 리소스의 사본임을 나타냄 헤더를 검증하지못한 경우 발생.|
| 204 | No Content | 응답에 본문이 없음을 나타냄. 웹 브라우저를 새 문서로 이동시키지 않고 갱신할 때 사용.|
| 205 | Reset Content  | 요청이 성공적으로 처리되었으며 HTML폼에 채워진 모든값을 비우라고 말함.|
| 206 | Partial Content| 일부만 요청된 리소스가 성공적으로 전송되었음을 나타냄. |
### 3.4.3 300-399: 리다이렉션 상태 코드
클라이언트가 원하는 리소스에대해 다른 위치를 사용하라고 알리거나 대안 응답을 제공한다.
| 상태 코드 | 사유 구절 | 의미 |
|--|--|--|
| 300 | Multiple Choices | 클라이언트가 여러 리소스를 가리키는 URL을 요청한 경우 리소스의 목록과함께 반환<br> ex) 하나의 문서에 대해서 복수개의 언어버전|
| 301  | Moved Permanently | 요청한 URL이 옮겨졌을때 사용한다. Location헤더에 현재 리소스의 URL을 포함해야 한다. |
| 302 | Found | 301과 같다. 클라이언트는 Location헤더로 주어진 리소스를 가리키기위한 목적으로 사용. |
| 303 | See Other | 리소스를 다른 URL에서 가져와야한다고 말해줄 때 사용한다. |
| 304 | Not Modified | 조건부 요청에 대해 최신상태임을 의미한다. 본문을 가져서는 안됨. |
| 305 | Use Proxy | 요청된 리소스는 프록시를 사용하여 접근해야 함을 나타낸다. 프록시의 위치는 Location 헤더를 통해 주어진다.   |
| 306 | Switch Proxy  | [HTTP/1.1 명세안 초안에서 제안되었지만, HTTP/1.1 최종 릴리스 이전에 제거되고 사용되지않음](https://http.dev/306) |
| 307 | Temporary Redirect  | 요청한 리소스가 일시적으로 새로운 위치로 이동되었음을 나타냄 (POST 요청은 변경되지 않음) |

### 3.4.4 400-499: 클라이언트 에러 상태 코드
서버가 다룰 수 없는 무언가에 대한 답.

| 상태 코드 | 사유 구절 | 의미 |
|--|--|--|
| 400 | Bad Request | 잘못된 요청이라고 알림 |
| 401 | Unauthorized | 요청한 리소스에 접근하기 위해 인증이 필요함 |
| 402 | Payment Required | 예약되어 있는 기능이나 서비스를 사용하려면 결제가 필요함 |
| 403 | Forbidden | 요청이 서버에 의해 거부되었음 |
| 404 | Not Found | 요청한 리소스를 서버에서 찾을 수 없음 |
| 405 | Method Not Allowed | 요청된 메서드가 리소스에 대해 허용되지 않음을 나타내고 클라이언트에게 알리기위해 Allow헤더가 포함되어야 한다. |
| 406 | Not Acceptable | 요청된 리소스가 클라이언트의 Accept 헤더와 호환되지 않음을 나타냄 |
| 407 | Proxy Authentication Required | 401 상태코드와 같음, 프록시 서버가 인증을 요구함을 나타냄 |
| 408 | Request Timeout | 요청이 서버에서 수행되기 전에 시간이 초과되었음을 나타냄 |
| 409 | Conflict | 요청이 현재 서버의 상태와 충돌이 발생했음을 나타냄 |
| 410 | Gone | 요청한 리소스가 서버에서 영구적으로 제거되었음을 나타냄 |
| 411 | Length Required | Content-Length 헤더 필드가 누락되었거나 0이 아닌 경우 요청을 거부함을 나타냄 |
| 412 | Precondition Failed | 요청에 포함된 전제 조건 중 하나가 서버에서 충족되지 않음을 나타냄 |
| 413 | Payload Too Large | 요청이 서버에서 처리할 수 있는 최대 크기를 초과함을 나타냄 |
| 414 | URI Too Long | 요청 URI가 서버에서 처리할 수 있는 최대 길이를 초과함을 나타냄 |
| 415 | Unsupported Media Type | 요청된 리소스가 지원되지 않는 미디어 타입임을 나타냄 |
| 416 | Range Not Satisfiable | 서버가 요청된 범위의 리소스를 만족시킬 수 없음을 나타냄 |
| 417 | Expectation Failed | Expect 요청 헤더의 조건을 만족시킬 수 없음을 나타냄 |

### 3.4.5 500-599: 서버 에러 상태 코드
올바른 요청도 에러가 발생할 수 있다. 클라이언트가 서버의 제한에 걸리거나 보조 구성요소에서 발생한 에러 일수 있다.
| 상태 코드 | 사유 구절| 의미|
|---|---|--|
| 500 | Internal Server Error | 서버에서 처리할 수 없는 오류가 발생함을 나타냄 |
| 501 | Not Implemented      | 서버가 요청된 기능을 지원하지 않음을 나타냄 |
| 502 | Bad Gateway          | 게이트웨이나 프록시 서버에서 응답을 받을 수 없음을 나타냄 |
| 503 | Service Unavailable  | 서버가 현재 사용 불가능하지만 나중에 가능함을 의미한다. 그 시기를 알리기위해 Retry-After 헤더를 포함할 수 있다. |
| 504 | Gateway Timeout      | 408과 유사하지만 게이트웨이나 프록시 서버가 요청에 대한 응답이 지연되어 게이트웨이나 프록시로부터 온 응답이라는 점이 다르다. |
| 505 | HTTP Version Not Supported | 서버가 요청된 HTTP 프로토콜 버전을 지원하지 않음을 나타냄  |

## 3.5 헤더
헤더의 분류
1. 일반 헤더
2. 요청 헤더
3. 응답 헤더
4. 엔터티 헤더
5. 확장 헤더 : 만들어졌지만 아직 승인되지않은 비표준 헤더. 의미를 모른다 하더라도 용인하고 전달해야한다. 

### 3.5.1 일반 헤더

 요청과 응답에 모두 사용되고 일반적이고 유용한 정보를 제공한다.

 #### 일반캐시헤더

 원 서버로 객체를 가져오는 대신 캐싱할 수 있도록 해주는 헤더를 도입.

### 3.5.2 요청 헤더
요청 메시지에서만 의미를 갖는 헤더.
| 헤더 이름 | 설명 |
| ------ | ----------- |
| Accept | 클라이언트가 이해하고 처리할 수 있는 미디어 유형을 나타내기 위해 사용. |
| Accept-Charset | 클라이언트가 수용 가능한 문자 인코딩을 나타내기 위해 사용. |
| Accept-Encoding | 클라이언트가 수용 가능한 콘텐츠 인코딩을 나타내기 위해 사용. |
| Accept-Language | 클라이언트는 응답에 대해 선호하는 언어를 서버에게 알리기 위해 사용. |

#### 조건부 요청 헤더
조건부 요청을 위한 헤더.
| 헤더 이름          | 예시                                    | 의미                                                            |
|--|--|--|
| If-Match          | If-Match: "etag"                             | 리소스의 현재 엔터티 태그가 주어진 태그와 일치하는 경우에만 리소스를 제공한다 |
| If-None-Match     | If-None-Match: "etag"                        | 리소스의 현재 엔터티 태그가 주어진 태그와 일치하지 않는 경우에만 리소스를 제공한다 |
| If-Modified-Since | If-Modified-Since: <날짜/시간>               | 지정된 날짜/시간 이후에 수정된 경우에만 리소스를 제공한다          |
| If-Unmodified-Since | If-Unmodified-Since: <날짜/시간>           | 지정된 날짜/시간 이후에 수정되지 않은 경우에만 리소스를 제공한다    |
| If-Range          | If-Range: "etag" 또는 If-Range: <날짜/시간>  | 지정된 엔터티 태그나 날짜/시간에 해당하는 리소스가 변경되었을 경우에만 리소스를 제공한다 |
| Range             | Range: bytes=<시작 바이트>-<끝 바이트>       | 서버로부터 특정 범위의 리소스를 요청한다 |

프로토콜 레벨의 역할 범위를 벗어난 기능 이라고 느껴진다.

#### 요청 보안 헤더
| 헤더 이름 | 설명 |
|--|--|
|Authorization|  클라이언트가 서버에 제공하는 인증 그 자체에 대한 정보|
|Cookie||
|Cookie2|요청자가 지원하는 쿠키의 버전|

#### 프락시 요청 헤더
| 헤더 이름| 설명| 예시|
|--|--|-|
| Max-Forwards| 요청이 프락시를 통해 전달될 수 있는 최대 횟수를 지정한다.| Max-Forwards: 10|
| Proxy-Authorization| 프락시에 대한 사용자 인증 정보를 제공한다.| Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ== |
| Proxy-Connection| 오래된 HTTP/1.1 호환성을 위해 사용되며, 프락시 연결 관리에 사용된다.   | Proxy-Connection: keep-alive|

### 3.5.3 응답 헤더

클라이언트에 부가 정보를 제공한다. 누가 보냈고 무엇을 할 수 있는지. 나중에 더 나은 요청을 할 수 있도록 도와준다.
| 헤더 이름          | 설명                                                         | 예시                                       |
|-|------|------|
| Age              | 리소스가 캐시된 후 지난 시간을 나타낸다.                     | Age: 360                                    |
| Public           | 리소스에 대한 공개 캐시 지시자를 제공한다.                  | Public: GET, HED OPTIONS                   |
| RetryAfter      | 서버가 일시적인 오류로 인해 클라이언트가 요청을 다시 시도해야 하는 시간을 제공한다. | RtryAfter: 120                        |
| Server           | 서버의 소프트웨어 정보를 제공한다.                           | Server: Apche2.4.38 (Ubuntu)               |
| Title            | 리소스의 타이틀을 제공한다.                                  | Title: Wecometo Example.com|
| Warning          | 리소스에 대한 경고 메시지를 제공한다.                        | Warning: 199 Miscellaneous warning          |

#### 협상헤더
조건부 요청에 대한 리소스를 고를때(협상)할 때 사용
| 헤더 이름          | 설명                                                         | 예시                                       |
|--|---|-|
| Accept-Ranges    | 서버가 바이트 범위 요청을 지원하는지 나타낸다.              | Acept-Ranges: bytes|
| Vary| 캐시의 요청에 따라 응답이 달라질 수 있는 조건을 지정한다.  | Vary: User-Agent|

### 3.5.4 엔티티 헤더
엔티티에 대해 설명하는 헤더.
| 헤더 이름 | 설명 |
|--|--|
| Allow | 해당 리소스에 대해 허용되는 HTTP 메서드를 나열한다.|
| Location | 클라이언트에 엔터티가 실제 위치하고있는 URL을 알려줄 때 사용.|

#### 콘텐츠 헤더
| 헤더 이름| 설명|
|--|--|
| Content-Base| 상대 URL을 계산하기 위한 기저 URL|
| Content-Encoding| 본문에 적용된 인코등 |
| Content-Language| 본문에 사용된 자연어 |
| Content-Length| 본문의 길이 혹은 크기 |
| Content-Location| 리소스의 실제위치 |
| Content-MD5| 리소스의 체크섬|
| Content-Range| 전체 리소스에서 이 엔티티가 해당하는 범위의 바이트 표현 |
| Content-Type| 본문의 객체타입 |

#### 엔터티 캐싱 헤더
일반 캐싱헤더는 언제 어떻게 캐시가 되어야 하는지에 대한 지시자를 제공한다.<br>
엔터티 캐싱 헤더는 리소스의 캐싱 사본이 유효한지, 만료되는 시점은 언제인지 추정하기위한 단서 등을 제공한다.
| 헤더 이름 | 설명 |
|--|--|
| ETag | 이 엔터티에 대한 태그|
| Expires | 만료시점 |
| Last-Modified  | 최근 변경된 일시 |

## 3.6 추가정보
